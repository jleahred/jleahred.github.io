<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>jle_cpp_tk: hp &amp; AST</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jleahred2s.jpeg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">jle_cpp_tk
   &#160;<span id="projectnumber">0.0  2015-04-03  sh1:&quot;bfef736926b62bf7cb5f149b615ab514f55fab17&quot;</span>
   </div>
   <div id="projectbrief">A small, safe, selft contained, soft-realtime C++ toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_src_core_hp_hp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">hp &amp; AST </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Full example on examples/project/idl</p>
<h2>Aim</h2>
<p>Enjoy!</p>
<p>A parser is an important tool for a programmer.</p>
<p>I'm also interested on <em>methaprograming</em>. One one to do it, and sometimes the only correct one, is creating <em>DSLs</em>.</p>
<p>In most cases, these <em>DSLs</em> has to be external. Working with external <em>DSLs</em> give you full freedom.</p>
<h2>Tools</h2>
<p>On <code>tools</code> folder we have <em>hpt</em> binary. It works with hp and <em>AST</em> to process inputs with grammars and generates files.</p>
<p>On <code>tools/qt</code> we have a small <em>ui</em> to work with grammars and templates</p>
<h2>Main actors</h2>
<h3>hp</h3>
<p>This is a simple LL(n) parser.</p>
<p>With it we can validate inputs with a specific grammar.</p>
<p>This is dynamic, therefore not fast.</p>
<p>It will create an <em>AST</em></p>
<h3>AST</h3>
<p>As a result of parsing a file with a grammar, an <em>AST</em> will be generated.</p>
<p>We can process this <em>AST</em> with a <em>c++* program, or we can use the *templates</em> transformation.</p>
<h3>Templates</h3>
<p>A template is a piece of text with functions calls.</p>
<p>These functions will transform the parameters, create variables and they also will return a <em>template</em></p>
<h2>Defining a grammar</h2>
<h3>Basic grammars</h3>
<p>Let's start with a common and simple exercise, parsing a math equation.</p>
<p>Lets start with hello world on grammars...</p>
<div class="image">
<img src="images/hello_world1.png"  alt="Image"/>
</div>
<p>This grammar, accepts one or several 'a' char. Simple.</p>
<p>The first line, defines the initial <em>non terminal</em> symbol</p>
<p><b>NON Terminal symbols</b> will be on upper case</p>
<p><b>Terminal symbols</b> will be on lower case</p>
<p>As you can see, it derives by left.</p>
<p>Now, let's have a sequence of 'a' followed by 'b' and a sequence of 'a' again Lets try next one, parenthesis...</p>
<p>It has to accept things like...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;abaaa</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;aaaabaa</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;aba</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;B ::= A  b  A</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;A ::= a A</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;A ::= a</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;a ::= &#39;a&#39;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;b ::= &#39;b&#39;</div>
</div><!-- fragment --><p> Great.</p>
<p>But now, we want same quantity of 'a' at the beginning and at the end.</p>
<p>It has to accept things like...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;aaabaaa</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;aaaabaaa</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;aba</div>
</div><!-- fragment --><p>But not...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;aabaaa</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;aaaaba</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;ab</div>
</div><!-- fragment --><p> Let's try</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;B ::= a  b  a</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;B ::= aa  b  aa</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;B ::= aaa  b  aaa</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;a ::= &#39;a&#39;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;b ::= &#39;b&#39;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;aa ::= &#39;aa&#39;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;aaa ::= &#39;aaa&#39;</div>
</div><!-- fragment --><p>From now on, lasts lines will indicate a valid input, rest of lines will be the grammar</p>
<p>This is not a full solution, and it's not an elegant one either.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;B ::= a  B  a</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;B ::= b</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;a ::= &#39;a&#39;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;b ::= &#39;b&#39;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;input: aaabaaa</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;input: aba</div>
</div><!-- fragment --><p>This looks great. Generic, concise, simple.</p>
<p>We can move it to parenthesis...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;B ::= ( B )</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;B ::= b</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;b ::= &#39;b&#39;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;( ::= &#39;(&#39;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;) ::= &#39;)&#39;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;input: (((b)))</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;input: (b)</div>
</div><!-- fragment --><h3>Expressions grammar</h3>
<p>Let's start with numbers.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  NUM</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;NUM  ::=  d NUM</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;NUM  ::=  d</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;d ::= ([0-9])</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;input: 123456</div>
</div><!-- fragment --><p>Terminal symbols can be defined as <em>regular expressions</em> in order to simplify the rule.</p>
<p>To keep the example simple, we will let numbers of any size and just integers.</p>
<p>If terminal symbols can be written as <em>regular expressions</em>, then we can simplify...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  num</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;num ::= ([0-9]+)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;input: 123456</div>
</div><!-- fragment --><p>Added one operator </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  num operator num</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;num ::= ([0-9]+)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;operator ::= ([\+|\-|\*|\/])</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;input: 1+2</div>
</div><!-- fragment --><p>But expressions has to accept multiple operators and numbers...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  num operator EXPR</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;EXPR ::=  num</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;num ::= ([0-9]+)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;operator ::= ([\+|\-|\*|\/])</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;input: 1+2*3</div>
</div><!-- fragment --><p>And what about the parenthesis?... </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  ( EXPR ) operator EXPR</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;EXPR ::=  ( EXPR )</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;EXPR ::=  num operator EXPR</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;EXPR ::=  num</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;num      ::= ([0-9]+)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;operator ::= ([\+|\-|\*|\/])</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;(        ::= &#39;(&#39;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;)        ::= &#39;)&#39;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;input: (1+2)*3</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;input: (1*(3+2))*3+(8*9)</div>
</div><!-- fragment --><p>We could want to let spaces between elements.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR ::=  _ ( _ EXPR _ ) _ operator _ EXPR</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;EXPR ::=  ( _ EXPR _ )</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;EXPR ::=  num _ operator _ EXPR</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;EXPR ::=  num</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;num      ::= ([0-9]+)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;operator ::= ([\+|\-|\*|\/])</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;(        ::= &#39;(&#39;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;)        ::= &#39;)&#39;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;_        ::= ([ |\t]*)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;input: ( 1+2 ) *3</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;input: (1* (3  +2 ) )* 3+( 8* 9  )</div>
</div><!-- fragment --><p>This grammar will produce next tree for entrance <code>(1* (3 +2 ) )* 3+( 8* 9 )</code></p>
<div class="image">
<img src="images/expression_simple.png"  alt="Image"/>
</div>
<p>Fantastic, but, what if we want to consider operator priority?...</p>
<p>Here it is...</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;EXPR</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;EXPR    ::=    _ unaryoperator _ ADDS _</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;EXPR    ::=    ADDS</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;ADDS    ::=    FACTS _ add_operator _ ADDS</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;ADDS    ::=    FACTS</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;FACTS   ::=    VAL _ mult_operator _ ADDS</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;FACTS   ::=    VAL</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;VAL     ::=    FUNC _ ( _ EXPR _ )</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;VAL     ::=    _ num</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;VAL     ::=    VAR</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;VAR     ::=    _ id</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;FUNC    ::=    _ id</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;FACTS   ::=    _ ( _ EXPR _ )</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;num           ::=    ([0-9]+)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;id            ::=    ([a-z|A-Z][0-9|a-z|A-Z|_]*)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;id            ::=    (_+[0-9|a-z|A-Z]+[0-9|a-z|A-Z|_]*)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;mult_operator ::=    ([\*|\\])</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;add_operator  ::=    ([\+|\-])</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;unaryoperator ::=    ([\+|\-])</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;_             ::=    ([ |\t]*)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;(             ::=    (\()</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;)             ::=    (\))</div>
</div><!-- fragment --><p>And here is the tree with correct priority for input <code>1+2*3</code>...</p>
<div class="image">
<img src="images/expresion_priority.png"  alt="Image"/>
</div>
<h3>terminal especial rules</h3>
<ul>
<li>Predefined constants<ul>
<li>__any__ -&gt; any value</li>
<li>__isalpha__ -&gt; letter</li>
<li>__islower__</li>
<li>__isupper__</li>
<li>__isdigit__</li>
<li>__isalnum__</li>
<li>__endl__</li>
<li>__isspace__</li>
<li>__isspace*__ -&gt; zero or more spaces</li>
<li>__isspace+__ -&gt; one or more spaces</li>
<li>__space_tab__ -&gt; space or tab</li>
<li>All the constants can be negated with **!**</li>
</ul>
</li>
<li>Regular expressions<ul>
<li>It will be rounded by parenthesis</li>
</ul>
</li>
<li>Literals<ul>
<li>Marked with **'**</li>
</ul>
</li>
<li>Klein star<ul>
<li>If the rule finished with __*__, it will be processed as a Klein star</li>
</ul>
</li>
</ul>
<h3>Non terminal especial rules</h3>
<ul>
<li>Klein star<ul>
<li>If the rule finished with __*__, it will be processed as a Klein star</li>
</ul>
</li>
</ul>
<h2>Transforming text</h2>
<p>Validating files is quite interesting.</p>
<p>Parsing files and generating <em>AST</em> is even better.</p>
<p>Once you have the <em>AST</em>, you can do things depending of the input file.</p>
<p>Great!!!!</p>
<p>But many times, the result will be text, perhaps, another file.</p>
<p>Even when is not the case, generating a normalized text is an interesting option (some times a very good one) to process the input.</p>
<p>Generating <em>DSLs</em> is a good example.</p>
<p>That's the main reason why I build this lib, and in these cases, the game consists on getting a text, validate it, and generating a different text.</p>
<p>The output could be also... a program in bytecode or c++, or embedded language.</p>
<p>Yes! this is external DSL</p>
<p>Lets see one example with the expression grammar.</p>
<p>Look to <code>##transf2-&gt;</code></p>
<p>``` MAIN</p>
<p>MAIN ::= EXPR</p>
<p>EXPR ::= _ VAR _ = _ EXPR ##transf2-&gt; $(<b>endl</b>)copy2: EXPR ::= _ VAL _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(EXPR') EXPR ::= _ unaryoperator VAL _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>)$(EXPR') EXPR ::= _ ( _ EXPR _ ) _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(EXPR') EXPR ::= _ unaryoperator ( _ EXPR _ ) _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>)$(EXPR') EXPR' ::= POWER EXPR' ::= FACTOR EXPR' ::= SUM</p>
<p>POWER ::= _ powerop _ VAL _ POWER ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) POWER ::= _ powerop _ VAL _ FACTOR ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) POWER ::= _ powerop _ VAL _ SUM ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) POWER ::= _ powerop _ ( _ EXPR _ ) _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>)$(EXPR')</p>
<p>FACTOR ::= _ mult_operator _ VAL _ POWER ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) FACTOR ::= _ mult_operator _ VAL _ FACTOR ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) FACTOR ::= _ mult_operator _ VAL _ SUM ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) FACTOR ::= _ mult_operator _ ( _ EXPR _ ) _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>)$(EXPR')</p>
<p>SUM ::= _ add_operator _ VAL _ POWER ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) SUM ::= _ add_operator _ VAL _ FACTOR ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) SUM ::= _ add_operator _ VAL _ SUM ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>) SUM ::= _ add_operator _ ( _ EXPR _ ) _ EXPR' ##transf2-&gt; $(<b>endl</b>)$(<b>endl</b>)$(EXPR') SUM ::= _</p>
<p>VAL ::= FUNC _ ( _ EXPR _ ) _ ##transf2-&gt; fun/1: VAL ::= FUNC _ ( _ EXPR _ , _ EXPR _ ) _ ##transf2-&gt; $(<b>endl</b>)$(EXPR#1)fun/2:</p>
<p>VAL ::= num VAL ::= VAR VAR ::= id ##transf2-&gt; var: FUNC ::= id</p>
<p>num ::= ([0-9]*.[0-9]+) ##transf2-&gt; num: num ::= ([0-9]+.[0-9]*) ##transf2-&gt; num: num ::= ([0-9]+) ##transf2-&gt; num: id ::= ([a-z|A-Z][0-9|a-z|A-Z|_]*) id ::= (_+[0-9|a-z|A-Z]+[0-9|a-z|A-Z|_]*) powerop ::= (\^) ##transf2-&gt; fun/2: mult_operator ::= ([*|\/]) ##transf2-&gt; fun/2: add_operator ::= ([+|-]) ##transf2-&gt; fun/2: unaryoperator ::= ([+|-]) ##transf2-&gt; fun/1: _ ::= ([ |]*) ##transf2-&gt; $(<b>nothing</b>) ( ::= (() ) ::= ()) , ::= (,) = ::= (=) ```</p>
<p>Very simple. You can generate an output for the subtree, using <em>vars</em> to refer the information on AST, and some predefined vars</p>
<p>And it will generate for input <code>1+2*3 +(7/9*5) +1</code>...</p>
<p>``` num:1 num:2 num:3 fun/2:* num:7 num:9 fun/2:/ num:5 fun/2:*</p>
<p>fun/2:+ num:1 fun/2:+</p>
<p>fun/2:+ ```</p>
<p>A small program, easy to process</p>
<p>You can see a example <a href="https://github.com/jleahred/jle_cpp_tk/tree/master/examples/project/calculator">here</a></p>
<p>This is a simple calculator, with vars, functions (extensible), operator priority...</p>
<ul>
<li>Predefined vars<ul>
<li>__endl__</li>
<li>__space__</li>
<li>__dollar_open_par__</li>
<li>__close_par__</li>
<li>__counter__</li>
</ul>
</li>
</ul>
<h3>Beyond</h3>
<p>When you need to work with complex transformation rules, you can define them outside the grammar rule.</p>
<p>``` [...] EXPR ::= _ VAR _ = _ EXPR ##transf2-&gt; </p>
<p>[...]</p>
<p><b>BEGIN_TEMPLATE</b>:: EXPR_TPL</p>
<p>copy2: <b>END_TEMPLATE</b>:: ```</p>
<p>You can also define vars to be used as functions (a kind of macro system).</p>
<p>Let see an example from <em>idl</em></p>
<p>``` MAIN ::= FRAME* ##transf2-&gt;</p>
<p><b>BEGIN_TEMPLATE</b>:: GENERATE_CODE $(<b>set</b> FRAME_TYPE ~ $(<b>set</b> TYPE_OPTIONAL <a class="el" href="classjle_1_1optional.html" title="Class template for optional values. ">jle::optional</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_RECOMENDED <a class="el" href="classjle_1_1optional.html" title="Class template for optional values. ">jle::optional</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_LIST <a class="el" href="classjle_1_1list.html">jle::list</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_WITH_DEFAULT_DATE )~ ~ $(<b>set</b> TYPE_WITH_DEFAULT )~ ~ $(<b>set</b> COMP_TYPE_NO_END ::)~ ~ $(<b>set</b> COMP_TYPE_END )~ ~ $(<b>run</b>)~ ~ )~ ~    <b>END_TEMPLATE</b>:: ```</p>
<p>** will write the template content as expected.</p>
<p>``` $(<b>set</b> ... ```</p>
<p>is a function. In this case, when <b>FRAME_TYPE</b> will be reached, it will be replaced by a lot of new **__set__**, a **__run__** and ****</p>
<p>The **~** symbol at the beginning of the line, means... <em>ignore spaces</em>. And same symbol at the end, means, remove new line.</p>
<p>This lets us to redefine vars, and even define vars with vars inside. When AST is processed, the vars will be replaced by their value. If the value contains vars, the will be replaced by value again, and so...</p>
<p>Once we have declared vars, could be necessary to run again the subtree in order to apply the new defined values. This is done with **__run__** function</p>
<p>Functions, starts with **$(** and ends with **)**</p>
<ul>
<li>Defined functions<ul>
<li>-&gt; this is a special implicit function it's equivalent to <b>get __VAR_NAME__</b></li>
<li>__ident+__ -&gt; increase identation</li>
<li>__ident-__</li>
<li>__date_time__</li>
<li>__date__</li>
<li>__run__ -&gt; run again subtree applying current vars</li>
<li>__prune__</li>
<li>__nothing__</li>
<li>__set__</li>
<li>__copy__</li>
<li>__alignc__</li>
<li>__lmargin__</li>
</ul>
</li>
</ul>
<p>This is a declarative language and inmutable.</p>
<p>In some cases, inmutability will require too much computation and complex code. For example, creating a counter.</p>
<p>To deal with these situations (just as exceptions), next mutable functions are provided...</p>
<ul>
<li>__set_mut__</li>
<li>__get_mut__</li>
<li>__inc__</li>
<li>__dec__</li>
</ul>
<p>Lets go back to the <em>idl</em> example...</p>
<p>``` MAIN ::= FRAME* ##transf2-&gt;</p>
<p><b>BEGIN_TEMPLATE</b>:: GENERATE_CODE $(<b>set</b> FRAME_TYPE ~ $(<b>set</b> TYPE_OPTIONAL <a class="el" href="classjle_1_1optional.html" title="Class template for optional values. ">jle::optional</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_RECOMENDED <a class="el" href="classjle_1_1optional.html" title="Class template for optional values. ">jle::optional</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_LIST <a class="el" href="classjle_1_1list.html">jle::list</a>&lt;&gt;)~ ~ $(<b>set</b> TYPE_WITH_DEFAULT_DATE )~ ~ $(<b>set</b> TYPE_WITH_DEFAULT )~ ~ $(<b>set</b> COMP_TYPE_NO_END ::)~ ~ $(<b>set</b> COMP_TYPE_END )~ ~ $(<b>run</b>)~ ~ )~ ~    <b>END_TEMPLATE</b>:: ```</p>
<p>Once the <em>AST</em> is ready, we will run it in order to generate the output.</p>
<p>In this case, **** will be replaced by the template content bellow.</p>
<p>Processing it, will declarate a variable <b>FRAME_TYPE</b>, will add the content of forward, h and cpp files...</p>
<p>``` MAIN ::= FRAME* ##transf2-&gt;</p>
<p><b>BEGIN_TEMPLATE</b>:: GENERATE_CODE $(<b>set</b> FRAME_TYPE [...]) ~    <b>END_TEMPLATE</b>:: ```</p>
<p>Let's see the <b>H_FILE</b></p>
<p>``` <b>BEGIN_TEMPLATE</b>:: H_FILE <b>BEGIN_FILE</b>::$(<b>file_name</b>).h // generated on $(<b>date_time</b>)</p>
<p>#include &lt;cstdint&gt; #include &lt;string&gt; #include "core/tuple.hpp" #include "core/optional.hpp" #include "core/dbl.h" #include "core/cont/list.hpp"</p>
<p>$(<b>set</b> MODULE )~ $(<b>set</b> RECORD )~ $(<b>set</b> TUPLE )~ $(<b>set</b> ENUMERATION )~ $(<b>set</b> UNION )~ $(<b>run</b>)</p>
<p>$(FRAME*) $(<b>endl</b>)$(<b>endl</b>)$(<b>endl</b>) <b>END_TEMPLATE</b>:: ```</p>
<p>It writes some text, declare some vars and will write **$(FRAME*)**</p>
<p>One example with counters...</p>
<p>``` <b>BEGIN_TEMPLATE</b>:: COUNT_TUPLE_FIELDS $(<b>nothing</b> count number of fields)~ $(<b>set_mut</b> PCOUNTER 0)~ $(<b>set</b> F_NO_NAMED_NOEND $(<b>inc</b> PCOUNTER))~ $(<b>set</b> F_NO_NAMED_END $(<b>nothing</b>))~ $(<b>run</b>)~ <b>END_TEMPLATE</b>::</p>
<p>[...]</p>
<p>~ $(<b>nothing</b> write fields with counter)~ $(<b>set</b> F_NO_NAMED_NOEND  p$(<b>get_mut</b> PCOUNTER)$(<b>dec</b> PCOUNTER),$(<b>endl</b>))~ $(<b>set</b> F_NO_NAMED_END  p$(<b>get_mut</b> PCOUNTER)$(<b>dec</b> PCOUNTER))~ $(<b>run</b>)</p>
<p>```</p>
<p>You can see a complete example here <a href="https://github.com/jleahred/jle_cpp_tk/tree/master/examples/project/idl">idl</a></p>
<h2>Tooling</h2>
<p>Great, we have a LL(n) parser, with rules and templates to generate an output.</p>
<h3>Grammar and templates processor</h3>
<p>This has been used to create <a href="https://github.com/jleahred/jle_cpp_tk/tree/master/tools/hpt">hpt</a></p>
<p>This is a small program who lets us to define the input files, and grammar with template files.</p>
<p>It will run all, and will produce the result.</p>
<h3>Grammar and template editor</h3>
<p><a href="https://github.com/jleahred/jle_cpp_tk/tree/master/tools/qt/hpgui">hpgui</a></p>
<p>This is a simple Qt program who helps us to write grammars, templates and debug it</p>
<p>You can work with several grammars and choose the proper one.</p>
<div class="image">
<img src="images/choose_grammar.png"  alt="Image"/>
</div>
<p>You can edit the grammar and templates</p>
<div class="image">
<img src="images/edit_grammar.png"  alt="Image"/>
</div>
<p>You can edit the input</p>
<div class="image">
<img src="images/edit_input.png"  alt="Image"/>
</div>
<p>You can edit show the tree with transformations applied</p>
<div class="image">
<img src="images/show_tree.png"  alt="Image"/>
</div>
<p>You can show the output</p>
<div class="image">
<img src="images/show_output.png"  alt="Image"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Feb 20 2016 23:11:47 for jle_cpp_tk by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
